# 用户管理

## 1. 添加用户

1. 添加超级用户需要切换至admin数据库

  `use admin`

2. 建立用户。注意：MongoDB V3版本不再支持addUser函数

  ```
  db.createUser(
     {
       user: "accountUser",
       pwd: "password",
       roles: [ "readWrite", "dbAdmin" ]
     }
  )
  ```

  成功则返回`Successfully added user:xxx`

  <font color = 'red'>Note:</font>

  若使用用户名密码连接时授权不成功（server端报 `Failed to authenticate ... credentials missing in the user document `）需要将授权算法版本更改。步骤：首先删除用户：
  ```
  db.system.users.remove({})    <== removing all users
  db.system.version.remove({}) <== removing current version
  db.system.version.insert({ "_id" : "authSchema", "currentVersion" : 3 })
  ```
  再重新启动mongod 并重新建立用户。

## 2. 权限认证（Authenticate）

    use db_name
    db.system("user_name", "user_pwd" )

## 3. 常用函数

    db.system.users.find(): 　查看用户
    db.auth() ：Authenticates a user to a database.
    db.createUser() ：Creates a new user.
    db.updateUser() ：Updates user data.
    db.changeUserPassword() ：Changes an existing user’s password.
    db.dropAllUsers() ：Deletes all users associated with a database.
    db.dropUser() ：Removes a single user.
    db.grantRolesToUser() ：Grants a role and its privileges to a user.
    db.revokeRolesFromUser() ：Removes a role from a user.
    db.getUser() ：Returns information about the specified user.
    db.getUsers() ：Returns information about all users associated with a database.


  参考：
  http://stackoverflow.com/questions/29006887/mongodb-cr-authentication-failed
