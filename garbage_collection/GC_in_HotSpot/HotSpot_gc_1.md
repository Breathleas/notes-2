## summary: Memory Management in the Java HotSpot™ Virtual Machine
## 1. 基本概念 Basic Concepts

A broad overview of memory management in the Java HotSpot virtual machine (JVM) in
Sun’s J2SE 5.0 release.

#### 

内存管理是指：识别不再被使用的对象、释放相应的内存，使得这些内存能够被后续的分配请求使用，这一过程。在一些语言中，内存管理是编程者的工作。而这项任务的复杂性导致程序错误的经常性出现。显式内存管理的常见问题有：1）过早的deallocation（可导致dangling references）2）内存泄漏（没有及时释放内存）。作为显示内存管理的替代方案，垃圾回收是一种自动的内存管理机制，现今尤其是在现代的面向对象编程语言中被广泛采用。垃圾回收解决了以上两个问题。

不再被引用的对象被认为是死对象，称作*垃圾*。垃圾回收就是找到这些对象并回收它们所占用的内存这一过程。垃圾回收本身要占用一定资源，其实现是对编程者透明的。内存通常从一个大块的称为*堆*的内存池分配。垃圾回收的时机由垃圾回收器决定，典型地，堆的整体或部分在被占满或达到一定阈值时被回收。垃圾回收算法主要面对的问题是如何在维持分配与释放的效率的同时避免内存碎片化。

####期待的垃圾回收特点

- 安全性与综合性：存活的数据不能被错误地回收；而垃圾应在较少的回收周期内被回收。
- 效率：一个合乎心意的垃圾回收器应当高效地运行，而不会引入长时间的在程序运行停滞。然而实际计算机系统要在时间、空间、垃圾收集频率之间权衡。例如较大的堆会在较长时间后才被填满，故垃圾回收频率低，然而一次垃圾回收时间会比较长。
- 避免碎片化：随着程序运行，释放的内存可能会形成一些小的分散块，使得要新建大的对象时没有足够的连续内存。*紧凑/压缩（compaction）*是一种消除碎片的方式。
- 可扩展性（Scalability）：分配与收集都不应成为运行在多核系统上的多线程程序的瓶颈。

####设计选择

- 串行vs并行（Serial versus Parallel）。垃圾回收算法是单线程的还是多线程的。

- Concurrent versus Stop-the-world：当stop-the-world式垃圾回收运行，应用程序的执行完全终止。而concurrent垃圾回收中，一些垃圾回收任务可以与程序同时进行。典型的concurrent垃圾回收中，大部分工作与程序同时进行，而偶尔进行stop-the-world操作。相比较而言，stop-the-world实现较简单；而由于被回收的对象可能被程序更改，concurrent垃圾回收需要额外注意，虽然需要的停止时间更短，但往往要消耗更多空间和效率。

- 紧凑vs不紧凑vs拷贝。
	- 紧凑：垃圾回收器将活的对象移动到一起以紧凑内存，因此分配时只需从空闲区域开头分配。
	- 不紧凑：不进行紧凑的垃圾回收器就地释放对象。虽然回收过程块，但可能引起碎片化，并且再分配所用时间很可能较长：需要搜索堆来找到足够大小的连续内存来容纳新对象。
	- 拷贝收集：将活的对象拷贝到另一个内存区。优点是原来的区域就作为空闲区，能够快速分配；缺点是需要额外的拷贝时间和额外的内存区域。
 
####性能度量
- Throughput(吞吐率):（长时间运行的情况下）总运行时间中未被用在垃圾回收的百分比。
- 垃圾回收开支：总运行时间中用于垃圾回收的百分比。
- 暂停时间：在垃圾回收进行时应用程序停止的时间长度。
- 回收频率：相对于应用程序运行，垃圾回收出现的频率。
- Footprint（内存印记/内存占用）：size的度量，例如堆的大小。
- Promptness（及时性）：一个对象成为垃圾到它被回收所经过的时间。

交互式应用可能需要更小的暂停时间，而非交互式应用也许更重视总体的运行时间。等等。

####分代收集（世代收集）Generational Collection

在分代收集中，内存被分为不同的*代（generation）*--分离的内存池，来存放不同年龄的对象。对于不同的代可以采用不同的垃圾回收算法，每种算法根据相应的代的特点进行优化。分代收集利用了称为*weak generational hypothesis*的观测结果，即：

 - 大多数对象的存活时间较短；
 - 从老年代到年轻代的引用较少。

对年轻代的收集频率较高、并且速度较快。因为年轻代空间通常较小，并且包含很多不再被引用的对象。在年轻代收集进行一些次数后仍旧存活的对象最终被*提升*到老年代。老年代通常比年轻代更大，并且增长缓慢。老年代得回收频率较低，但显著地需要更长的时间。

在垃圾回收算法选择上，对年轻代的收集更注重速度（因为更频繁），而对老年代的收集更注重空间利用率。



<br/><br/><br/>
